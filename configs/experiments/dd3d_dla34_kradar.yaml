# @package _global_
defaults:
  - /evaluators/kitti_3d@EVALUATORS.KITTI3D
  - override /meta_arch@_global_: dd3d
  - override /train_datasets@DATASETS.TRAIN: kradar_train_good_v3
  - override /test_datasets@DATASETS.TEST: kradar_test_good_v3
  - override /feature_extractors@FE: dla34_fpn

MODEL:
  # from-coco, IODA-pretrained.
  CKPT: weights/depth_pretrained/depth_pretrained_dla34-y1urdmir-20210422_165446-model_final-remapped.pth
  # CKPT: /home/andy/Downloads/tmp_dd3d/model_0079999.pth
FE:
  BACKBONE:
    NORM: FrozenBN
  FPN:
    NORM: FrozenBN
  OUT_FEATURES: ${.FPN.OUT_FEATURES}

DD3D:
  FCOS2D:
    NORM: BN
    INFERENCE:
      NMS_THRESH: 0.75

  FCOS3D:
    NORM: FrozenBN

INPUT:
  RESIZE:
    # kradr images are (720, 1280)
    MIN_SIZE_TRAIN: [624, 640, 656, 672, 688, 704, 720, 736, 752, 768, 784, 800, 816, 832]
    MAX_SIZE_TRAIN: 10000
    MIN_SIZE_TEST: 720
    MAX_SIZE_TEST: 100000

SOLVER:
  IMS_PER_BATCH: 16
  BASE_LR: 0.002
  MAX_ITER: 100000
  STEPS: [80000, 90000]
  WARMUP_ITERS: 10000
  MIXED_PRECISION_ENABLED: True
  CHECKPOINT_PERIOD: 10000

TEST:
  ENABLED: True # change
  IMS_PER_BATCH: 1
  EVAL_PERIOD: 10000
  AUG:
    ENABLED: False
    MIN_SIZES: [656, 704, 736, 768, 816]
    MAX_SIZE: 100000
    FLIP: True

DATALOADER:
  TRAIN:
    NUM_WORKERS: 6
    SAMPLER: RepeatFactorTrainingSampler
    REPEAT_THRESHOLD: 0.4


EVAL_ONLY: False # change

VIS:
  DATALOADER_ENABLED: False
  PREDICTIONS_ENABLED: False

EVAL_ON_START: False

WANDB:
  ENABLED: False